(function(global){var PictureCarousel=function(el,options){this.el=typeof el==="string"?document.querySelector(el):el;this.options=options;this.current=0;this.count=options.listData.length;this.autoplayTimer=null;if(options.arrow){this.arrowClickable=true}};PictureCarousel.prototype={init:function(){var container_width=this.getStyle(this.el,"width");var container_height=this.getStyle(this.el,"height");container_width=parseInt(container_width.substring(0,container_width.length-2));container_height=parseInt(container_height.substring(0,container_height.length-2));this.generateHorizontalCarousel(container_width,container_height)},generateHorizontalCarousel:function(containerWidth,containerHeight){var that=this;var li_width=containerWidth/this.options.display;var li_height=containerHeight;var container_h_li="";for(var i=0;i<this.options.listData.length;i++){container_h_li+='<li style="width: '+li_width+"px;height: "+li_height+'px;"><img src="'+this.options.listData[i].src+'" alt="'+this.options.listData[i].alt+'" /></li>'}var container_h='<div class="horizontal-carousel"><ul>'+container_h_li+container_h_li+"</ul></div>";this.el.appendChild(this.parseElement(container_h));if(this.options.autoplay){if(this.options.direction==="left"){this.autoplayTimer=setInterval(function(){that.scroll2Left(li_width)},this.options.interval)}else{this.autoplayTimer=setInterval(function(){that.scroll2Right(li_width)},this.options.interval)}}if(this.options.arrow){var leftBtn=this.parseElement('<div class="horizontal-carousel-arrow-left" style="display: none;"></div>');var rightBtn=this.parseElement('<div class="horizontal-carousel-arrow-right" style="display: none;"></div>');this.el.childNodes[0].appendChild(leftBtn);this.el.childNodes[0].appendChild(rightBtn);this.addEvent(this.el.childNodes[0],"mouseenter",function(){if(that.autoplayTimer){clearInterval(that.autoplayTimer);that.autoplayTimer=null}leftBtn.style.display="block";rightBtn.style.display="block"});this.addEvent(this.el.childNodes[0],"mouseleave",function(){if(that.options.autoplay){if(that.options.direction==="left"){that.autoplayTimer=setInterval(function(){that.scroll2Left(li_width)},that.options.interval)}else{that.autoplayTimer=setInterval(function(){that.scroll2Right(li_width)},that.options.interval)}}leftBtn.style.display="none";rightBtn.style.display="none"});this.addEvent(leftBtn,"click",function(){if(that.arrowClickable){that.arrowClickable=false;that.scroll2Left(li_width);setTimeout(function(){that.arrowClickable=true},500)}});this.addEvent(rightBtn,"click",function(){if(that.arrowClickable){that.arrowClickable=false;that.scroll2Right(li_width);setTimeout(function(){that.arrowClickable=true},500)}})}if(this.options.dots){var dots="";for(var j=0;j<this.count;j++){dots+="<li index="+j+"></li>"}var dotsContainer=this.parseElement('<div class="carousel-indicator-dots"><ul>'+dots+"</ul></div>");this.el.childNodes[0].appendChild(dotsContainer);this.dots();var dot_sarr=this.el.childNodes[0].lastChild.childNodes[0].childNodes;for(var a=0;a<dot_sarr.length;a++){(function(a){that.addEvent(dot_sarr[a],"click",function(){that.clickDot(dot_sarr[a])})})(a)}}},scroll2Left:function(liWidth){var speed=liWidth/this.options.duration;var ul=this.el.childNodes[0].childNodes[0];var ul_left=this.getStyle(ul,"left");ul_left=parseInt(ul_left.substring(0,ul_left.length-2));var next_left=ul_left-liWidth;if(Math.abs(ul_left)<this.count*liWidth){var l=ul_left;var timer=setInterval(function(){l-=speed;if(l===next_left||l<next_left){clearInterval(timer);ul.style.left=next_left+"px"}else{ul.style.left=l+"px"}},5);if(this.current<this.count-1){this.current++}else{this.current=0}}else{ul.style.left="0px";this.current=0;this.scroll2Left(liWidth)}this.dots()},scroll2Right:function(liWidth){var speed=liWidth/this.options.duration;var ul=this.el.childNodes[0].childNodes[0];var ul_left=this.getStyle(ul,"left");ul_left=parseInt(ul_left.substring(0,ul_left.length-2));var next_left=ul_left+liWidth;if(ul_left===0||ul_left>0){var init_right=0-this.count*liWidth;ul.style.left=init_right+"px";this.current=0;this.scroll2Right(liWidth)}else{var l=ul_left;var timer=setInterval(function(){l+=speed;if(l===next_left||l>next_left){clearInterval(timer);ul.style.left=next_left+"px"}else{ul.style.left=l+"px"}},5);if(this.current>0){this.current--}else{this.current=this.count-1}}this.dots()},dots:function(){var dots_ul=this.el.querySelector(".carousel-indicator-dots").childNodes[0];for(var k=0;k<dots_ul.childNodes.length;k++){if(this.current===k){dots_ul.childNodes[k].setAttribute("class","dots-active")}else{dots_ul.childNodes[k].removeAttribute("class")}}},clickDot:function(event){var that=this;var target=parseInt(event.getAttribute("index"));var container_width=this.getStyle(this.el,"width");container_width=parseInt(container_width.substring(0,container_width.length-2));var li_width=container_width/this.options.display;if(target>this.current){var speed=li_width/this.options.duration;var ul=this.el.childNodes[0].childNodes[0];
var ul_left=this.getStyle(ul,"left");ul_left=parseInt(ul_left.substring(0,ul_left.length-2));var next_left;var max_left=-this.count*li_width;if(ul_left===max_left){ul.style.left="0px";this.current=0;next_left=0-(target-this.current)*li_width}else{next_left=ul_left-(target-this.current)*li_width}ul.style.left=next_left+"px";this.current=target;this.dots()}else{if(target<this.current){var speed=li_width/this.options.duration;var ul=this.el.childNodes[0].childNodes[0];var ul_left=this.getStyle(ul,"left");ul_left=parseInt(ul_left.substring(0,ul_left.length-2));var next_left=ul_left+(this.current-target)*li_width;var max_left=-this.count*li_width;ul.style.left=next_left+"px";this.current=target;this.dots()}}},getStyle:function(node,property){if(node.style[property]){return node.style[property]}else{if(node.currentStyle){return node.currentStyle[property]}else{if(document.defaultView&&document.defaultView.getComputedStyle){var style=document.defaultView.getComputedStyle(node,null);return style.getPropertyValue(property)}}}return null},parseElement:function(htmlString){var wrapper=document.createElement("div");wrapper.innerHTML=htmlString;return wrapper.firstChild},addEvent:function(elem,type,fn){if(elem.attachEvent){elem.attachEvent("on"+type,fn);return}if(elem.addEventListener){elem.addEventListener(type,fn,false)}}};if(typeof module!=="undefined"&&module.exports){module.exports=PictureCarousel}if(typeof define==="function"){define(function(){return PictureCarousel})}global.PictureCarousel=PictureCarousel})(this);